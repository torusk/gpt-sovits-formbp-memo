# GPT-SoVITS プロジェクト進捗まとめ ＆ 復旧手順

## 1. 現在の状況（進捗：90%）

* [x] **環境構築:** `uv` による仮想環境構築完了。
* [x] **学習用データ準備:** ASR（文字起こし）完了。
* [x] **学習（トレーニング）:** SoVITSおよびGPTの両モデルの学習が完了。
* [x] **推論準備:** 推論用WebUIの起動、モデルの読み込みまで成功。
* [!] **現在の課題:** 推論実行時に `libtorchcodec` 関連のエラーで停止（Mac特有の音声読み込みエラー）。

## 2. 推論エラーの修正（作業が必要です）

推論画面でも、学習時と同じように `torchaudio.load` を使わずに `librosa` を使うようにコードを1箇所書き換えます。

1. **ファイルを開く:** `GPT_SoVITS/inference_webui.py` をテキストエディタで開きます。
2. **インポート追加:** 1行目に `import librosa` を追記します。
3. **524行目付近を修正:**
* **修正前:** `audio, sr0 = torchaudio.load(filename)`
* **修正後:** `audio, sr0 = librosa.load(filename, sr=None)`
※ `audio = torch.FloatTensor(audio)` という行が必要になる場合がありますが、まずは上記を試してください。



---

## 3. 再起動の完全手順（全停止から動かすまで）

一旦全てを閉じた状態から、再度動かす手順です。

### ステップ1：ターミナルでプロジェクトへ移動

```bash
cd /Users/kazuki/Desktop/GPT-SoVITS

```

### ステップ2：WebUIの起動

```bash
uv run python webui.py

```

### ステップ3：ブラウザで操作（学習はスキップ）

1. ブラウザで `http://127.0.0.1:9874` を開きます。
2. **「1C-推論」** タブを直接開きます（学習は終わっているので1A, 1Bは不要です）。
3. **「モデルのパスを更新」** を押し、プルダウンから `xxx` が含まれる自分のモデルを選択します。
4. **「有効化TTS推論WebUI」** をクリックします。

### ステップ4：推論用WebUIで喋らせる

新しく開いた画面（ポート9872）で以下を入力します。

* **参照オーディオ:** 学習に使った5秒程度のwavファイルを選択
* **参照テキスト:** `こんにちは　これは　音声合成のテスト録音です。`
* **参照言語:** `日本語`
* **推論テキスト:** `你好，我是一树。很高兴见到你。`
* **推論言語:** `中国語` (または日本語)
* **「推論を開始」** をクリック！

---

## 4. トラブルシューティング（今回起きたこと）

| エラー | 原因 | 対策 |
| --- | --- | --- |
| `FileNotFoundError: fast-langdetect` | キャッシュ用フォルダがない | `mkdir -p .../fast_langdetect` で解決済み |
| `RuntimeError: libtorchcodec` | Macで音声読み込みに失敗 | `inference_webui.py` を `librosa` 使用に書き換える |

これを実行すれば、今度こそあなたの声が中国語を話し始めます！一歩ずつ、確実に進んでいます。